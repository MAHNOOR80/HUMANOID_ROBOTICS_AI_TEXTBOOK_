{
  "type": "function",
  "function": {
    "name": "retrieve_relevant_chunks",
    "description": "Retrieve relevant text chunks from the humanoid robotics textbook knowledge base using semantic search. This function searches the Qdrant vector database for content semantically similar to the user's query and returns the most relevant passages with similarity scores.",
    "parameters": {
      "type": "object",
      "properties": {
        "query": {
          "type": "string",
          "description": "The search query or question to find relevant textbook content for. This will be embedded using the same model as the stored chunks (Cohere embed-english-v3.0) and used for semantic similarity search."
        },
        "top_k": {
          "type": "integer",
          "description": "Maximum number of relevant chunks to retrieve. Defaults to 5. Higher values provide more context but may introduce noise.",
          "default": 5,
          "minimum": 1,
          "maximum": 20
        },
        "score_threshold": {
          "type": "number",
          "description": "Minimum similarity score threshold (0.0 to 1.0) for retrieved chunks. Only chunks with cosine similarity above this threshold will be returned. Defaults to 0.7 (high relevance). Lower values retrieve more chunks but with potentially lower quality.",
          "default": 0.7,
          "minimum": 0.0,
          "maximum": 1.0
        }
      },
      "required": ["query"]
    },
    "returns": {
      "type": "object",
      "description": "Retrieval result containing ranked text chunks with metadata",
      "properties": {
        "chunks": {
          "type": "array",
          "description": "List of retrieved text chunks ranked by similarity score (highest first)",
          "items": {
            "type": "object",
            "properties": {
              "chunk_id": {
                "type": "string",
                "description": "Unique identifier for the chunk in Qdrant"
              },
              "text": {
                "type": "string",
                "description": "The actual text content of the chunk"
              },
              "similarity_score": {
                "type": "number",
                "description": "Cosine similarity score (0.0-1.0) indicating relevance to query"
              },
              "metadata": {
                "type": "object",
                "description": "Source metadata from the textbook",
                "properties": {
                  "page_number": {
                    "type": "integer",
                    "description": "Page number in the original textbook"
                  },
                  "section_title": {
                    "type": "string",
                    "description": "Section or chapter title"
                  },
                  "chapter": {
                    "type": "string",
                    "description": "Chapter name"
                  },
                  "url": {
                    "type": "string",
                    "description": "Source URL from the textbook website"
                  },
                  "chunk_index": {
                    "type": "integer",
                    "description": "Sequential index of chunk in the document"
                  }
                }
              }
            }
          }
        },
        "retrieval_time_ms": {
          "type": "number",
          "description": "Time taken for the retrieval operation in milliseconds"
        },
        "total_candidates": {
          "type": "integer",
          "description": "Total number of chunks in the collection"
        },
        "filtered_count": {
          "type": "integer",
          "description": "Number of chunks above the score_threshold"
        }
      }
    },
    "errors": [
      {
        "code": "QDRANT_CONNECTION_ERROR",
        "description": "Failed to connect to Qdrant vector database",
        "handling": "Return error response with status='error' and descriptive error_message"
      },
      {
        "code": "EMBEDDING_GENERATION_ERROR",
        "description": "Failed to generate query embedding using Cohere API",
        "handling": "Return error response with status='error' and descriptive error_message"
      },
      {
        "code": "SEARCH_TIMEOUT",
        "description": "Qdrant search operation timed out",
        "handling": "Return error response with status='error' and suggest retrying"
      },
      {
        "code": "INVALID_QUERY",
        "description": "Query is empty, too long, or contains invalid characters",
        "handling": "Return error response with status='error' and validation message"
      }
    ],
    "usage_example": {
      "request": {
        "query": "What is inverse kinematics in humanoid robotics?",
        "top_k": 5,
        "score_threshold": 0.7
      },
      "response": {
        "chunks": [
          {
            "chunk_id": "chunk_1234",
            "text": "Inverse kinematics (IK) is the mathematical process of calculating the variable joint parameters needed to place the end of a kinematic chain, such as a robot manipulator, in a desired position and orientation...",
            "similarity_score": 0.89,
            "metadata": {
              "page_number": 42,
              "section_title": "Inverse Kinematics Fundamentals",
              "chapter": "Chapter 3: Motion Control",
              "url": "https://physical-ai-humanoid-robotics-textb-dun.vercel.app/chapter-3",
              "chunk_index": 15
            }
          }
        ],
        "retrieval_time_ms": 245.3,
        "total_candidates": 1500,
        "filtered_count": 12
      }
    }
  }
}
